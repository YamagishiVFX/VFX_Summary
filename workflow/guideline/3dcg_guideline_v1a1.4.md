# 3D制作ガイドライン v1.0.0 a1.4

- 個人の主観によるものです。一般的かどうか？は不明です。
- **記事の内容に一切の責任を持ちません。**


### Updated :
v1.0.0 a1.4
- ユニット単位編集
- 座標系編集

v1.0.0 a1.3 2022/06/01 CGsup Tatsuya Yamagishi
- 一部修正加筆

v1.0.0 a1.2 2022/05/31 CGsup Tatsuya Yamagishi
- 一部修正


<!-- # 概要：
- 実寸
- ユニット単位
- 座標系
- レンダラー
- ポリゴンのトポロジ -->




# 実寸作業
- **出来るだけ実寸作業** を心がける。
- アセットの大きさに基準が出来るため、汎用性が高くなる
- シーンスケールはレンダリングを始め、物理シミュレーションなど多くの結果に影響する。
  - 実寸で作業する事で、正しいシミュレーション結果を得やすくなる。

# ユニット単位
- 作業開始前に基準となる単位設定を決める。
- 途中で変更すると多くの**作業がやり直しになる** 可能性が高い。
  - 単純な **変換** は行列で対応が可能だが、複雑なRIGなどは破綻してしまう可能性が高い。
- 1unit = 1cm と決めた場合、1mの物体は 100 の大きさで作成する。
- ツール間でデータをやり取りする際に変換が必要になる場合はワークフローを準備する。
- 過去の資産運用（ライブラリ等）を考えるともっと大きな範囲でルール化した方が良い。
  - **今の所「cm」が基準** になっていることが多い気がする。
- ちなみに長さのSI単位はm。

### 主要ツールの単位
![image](https://i.gyazo.com/9fd7a2cbaca75bfc199725f1f14a9a2c.png)

| ツール名 | デフォルト値 | 変更可能 | 説明 |
| ------- |------- | ------- | ------- |
| Maya | cm | X | 表示単位の変更は可能だが内部的な数値はcm以外に変更出来ない。FBXなどユニット単位をファイルに内包出来るフォーマットで単位の変更が可能だが、この辺は沼 |
| 3dsMax | inchi（インチ） | 〇 | デフォルト値がインチという罠。システム単位の変更で、プロジェクト仕様に則った単位に変更してから作業。作業前に必ずチェックすべき項目。 |
| Houdini | m | X | SI単位を意識したか？m準拠 |
| Cinema 4D | cm | 〇 | |
| Blender | m | X | |
| Nuke | - | - | 僕の知る限りソフトの設計に単位という概念は無かったと思う。1unit = 1 というただの数値。コンポジットは最後に色んな素材が集中する工程であるため、ワークフローで単位を管理しないと、cm　基準だったり m 基準のデータが集まってカオスになるので、何かしらのルールは設けた方がいいとは思う。|
| After Effect | - | - | こちらも僕の知る限りでは **単位** という概念は無かった気がする。 |
| Unity | m | X | |
| Unreal Enging | cm | X | |

# フレームレート
- 作業の途中で変更すると **やり直しになる可能性が高い設定** 。作業開始前に確認するべき項目。
  - キーフレーム等、主にアニメーションに関連する事が破綻する事が多い。
  - 秒数が変わらない場合、フレーム数が足りないなどの問題が起きたり。
- 納品仕様に合わせて決定される事が多い。
  - TV → 29.976
  - 映画 → 23.976
  - 演出の関係で 23.976 で作成し 29.976に変更するものもある。（「映画のフレームレートの感じが良い」など）
- 多くのCGツールでは29.976など、実数のFPSを設定すると作業が複雑化するため30など正数で設定する事が多い。
- 編集ソフトなど動画作成時に29.976、23.976などに変換する事が多い。

# 開始フレーム
- フレームレートを変更するとフレームNoが変わってしまう事もあるため、フレームレートを決定した後に定義する項目。
  - 10秒が24fps だと 240fr。30fspだと300frと、フレーム数が異なるため。
- 実写系VFXでは1001frがHead-in。1009fr目がCut-inが最近ではスタンダードな気がする。
  - アニメーションが絡むアセット制作等に影響

# 座標系
- Y-up、Z-up
- Transform order
  - 変換行列の適用順の明示
      - Transform : SRT
      - Rotation : XYZ

- こちらもツールによって異なるためプロジェクト共通のルールを決める。
- 途中で変更するとRigなど座標計算が複雑な仕組みが破綻してしまう事が多い。

### 主要ツールの座標系

| ツール名 | デフォルト値 | 変更可能 | 説明 |
| ------- |------- | ------- | ------- |
| Maya | Y-up, Z- | 〇 |  |
| 3dsMax | Z-up, Y+ | 不明 |  |
| Houdini | Y-up , Z-| 不明 |  |
| Cinema 4D | Y-up, Z+ | 不明 | Cinema4Dは奥行きがZ+|
| Blender | Z-up, Y+ | 不明 | |
| Nuke | Y-up, Z- | 不明 | |
| After Effect | Y-up | 不明 |  |
| Unity | Y-up | 不明 | |
| Unreal Enging | Z-up | 不明  | |


# レンダラー
- **レンダラーによってワークフローが大きく異なる** ため、**メインで使うレンダラーを定義** する。
- レンダラーをプロジェクトの途中で変更すると **作業の多くがやり直しになる** 可能性が非常に高い。
- 光の計算のため、シーンの単位設定が大事なレンダラーもある。レンダラー個別でシーンスケールの設定が必要なものもある。

# マテリアル
- 基本的には**レンダラー専用のマテリアルを使う**
  - 最適化されているため余計な処理が行われず、**レンダリングコスト軽減**に繋がる
  - **正しい光のシミュレーション結果**が得られる。
- 物理ベースマテリアルタイプの定義
  - PBRのMetalness、Roughnessのタイプを決定。
    - タイプによってマテリアルのパラメータの意味が異なるため
    - (PBRなのに「Metalness」というパラメータがあるのは未だに納得していない)


## テクスチャ
- ファイルフォーマット、ビット深度、可逆圧縮 / 非可逆圧縮
- UDIM方式の決定
- OCIOを使用する際の命名規則（OCIOには色々な機能があり、ツールが対応している場合、ファイル名をキーとして自動でLUTを選択できる）


# トポロジ：
- 必要のない分割は極力しない
- 孤立した頂点は削除する

## 参考
* [ポリゴン分割するのに便利な画像集めました。](https://www.photoshop777.com/post-5774/)

## 裏表
- ポリゴンには裏と表が存在する。
- 「基本的には」レンダリングでは「裏面」の計算が省略される。（ゲームなどで物体にめり込むと外が丸見えになるなど）
- 表裏が正しく定義出来ていないと、レンダリング、物理シミュレーションなどで意図せぬ結果になってしまう事がある。
  - レンダリング
    - 屈折率は「真空から物体に光が侵入したときの数値」。表裏が逆だと、屈折率が逆数になってしまう。
    - 裏面の計算を省略する事があるため、真っ黒や意図せぬ色で計算されるなど。
    - 表、裏で処理が異なるマテリアルなどもある。
  - 衝突判定：裏面は衝突判定を省略しすり抜けてしまう事がある。


## 厚み
- 破壊などダイナミクス（物理シミュレーション用）
  - 出来るだけ現実のものと同じにする。
  - 基本的にぶっさしはNG
- レンダリング用
  - ダイナミクス用と考え方は同じ。出来るだけ現実のものと同じにする。
- クロスシミュレーション用
  - 現在のクロスシミュレーションは　**シミュレーション時にパラメータで厚みを設定する** のが基本だと思うので、厚みはモデリングしない。厚みを付けると正しくシミュレーション出来ない事が多い。

### Tips:
- [ジオメトリの法線や厚みによる屈折の見え方の違い](https://yamagishi-2bit.blogspot.com/2021/04/3d-material.html)

## 三角形ポリゴン、多角形ポリゴン
- 4角形ポリゴン以上の多角形ポリゴンの使用を極力避け、出来るだけ凹ポリゴンを作成しない。
- 現在のワークフローの場合、画面表示、画像出力共に殆どの場合、最終的には三角ポリゴンに変換されるのではないか？と思う

### 関連：
- [3dsmax : Mesh vs Polygon の考察。三角形ポリゴンと多角形ポリゴンの話](https://yamagishi-2bit.blogspot.com/2019/05/3dsmax-mesh-vs-polygon.html)

## サブディビジョン
- 「ビュー（画面表示）」と　「レンダリング」でパイプラインが異なる事が殆どであるため、結果や処理が異なる。最終出力のワークフローに注意。（近年、GPUの台頭によりその限りではない場合もある）
- シェーダー（レンダリング時の計算）でサブディビジョンを行う際は、三角形ポリゴン、四角形ポリゴンで結果が異なるので注意が必要。
  - [YouTube : Subdivision Surfaces: Artifacts](https://www.youtube.com/watch?v=k_S1INdEmdI&list=PLYURcfRkTI5XxXw4NixOb4gG02iHFbJr4&index=2)

# パス名とシーン構造、階層構造
- パス名を意識し管理しやすいシーン制作を心がける
- 必要なデータに素早くアクセス出来るようにしておく。
- プログラム的な知識が背景にあるとなおよし。
  - `*` によるワイルドカード、命名規則、ソート等。
- path名はalembicやusdを書き出す際の構造に影響する。

引用：[cgwiki Usd AssetGuide](https://www.tokeru.com/cgwiki/index.php?title=UsdAssetGuide)
![image](https://i.gyazo.com/fce75be9ed6a2fde266b65fe67df19a9.png)

# 関連：
- [実写系VFXワークフロー概要](https://vook.vc/n/4447)

