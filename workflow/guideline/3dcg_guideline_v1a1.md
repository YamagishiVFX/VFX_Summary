# 3D制作ガイドライン v1.0.0 a1.1

### Updated :
v1.0.0 a1.2 2022/05/31 CGsup Tatsuya Yamagishi
- 一部修正

v1.0.0 a1.1 2022/05/31 CGsup Tatsuya Yamagishi
- 追記

v1.0.0 a1.0 2022/05/26 CGsup Tatsuya Yamagishi
- 概要作成

# 概要：
- 実寸
- ユニット単位
- 座標系
- レンダラー
- ポリゴンのトポロジ


# 実寸作業
- **出来るだけ実寸作業** を心がける。
- シーンスケールはレンダリングを始め、物理シミュレーションなど多くの結果に影響する。
- 実寸で作業する事で、正しいシミュレーション結果を得やすくなる。

# ユニット単位
- 途中で変更すると多くの作業がやり直しになる可能性がある項目。
  - 単純な **変換** は行列で対応が可能だが、複雑なRIGなどは破綻してしまう可能性が高い。
- 作業開始前に基準となる単位設定を決める。
- ツール間でデータをやり取りする際に変換が必要になる場合はワークフローを準備する。

- 過去の資産運用（ライブラリ等）を考えるともっと大きな範囲でルール化した方が良い。
  - 今の所「cm」が基準になっていることが多い気がする。
- ちなみに長さのSI単位はm。

| ツール名 | デフォルト値 | 変更可能 | 説明 |
| ------- |------- | ------- | ------- |
| Maya | cm | X | 表示単位の変更は可能だが内部的な数値はcm以外に変更出来ない。FBXなどユニット単位をファイルに内包出来るフォーマットで単位の変更が可能だが、この辺は沼 |
| 3dsMax | inchi（インチ） | 〇 | デフォルト値がインチという罠。システム単位の変更で、プロジェクト仕様に則った単位に変更してから作業。作業前に必ずチェックすべき項目。 |
| Houdini | m | X | SI単位を意識したか？m準拠 |
| Blender | m | X | |
| Nuke | - | - | 僕の知る限りソフトの設計に単位という概念は無かったと思う。1unit = 1 というただの数値。コンポジットは最後に色んな素材が集中する工程であるため、ワークフローで単位を管理しないと、cm　基準だったり m 基準のデータが集まってカオスになるので、何かしらのルールは設けた方がいいとは思う。|
| After Effect | - | - | こちらも僕の知る限りでは **単位** という概念は無かった気がする。 |
| Unity | m | X | |
| Unreal Enging | cm | X | |

# フレームレート
- 作業の途中で変換すると **やり直しになる可能性が高い設定** 。作業開始前に確認するべき項目。
- 主にアニメーションのキーフレーム等が破綻する可能性が高い。
- エクスプレッションなどをフレームベースで記述していると破綻する場合がある。
- 納品仕様に適したFPSを設定する。
- 多くのCGツールでは29.976など、実数のFPSを設定すると作業が複雑化するため30など正数で設定する事が多い。
- 編集ソフトなど動画作成時に29.976、23.976などに変換する事が多い。

# 開始フレーム
- 実写系VFXでは1001frがHead-in。1009frがCut-inが最近ではスタンダードな気がする。
  - アニメーションが絡むアセット制作に影響

# 座標系
- Y-UP、ZUP
- Transform order
  - Transform : SRT
  - Rotation : XYZ

- こちらもツールによって異なるためプロジェクト共通のルールを決める。
- 途中で変換するとRigなど座標計算が複雑な仕組みが破綻してしまう事が多い。
  

# レンダラー
- レンダラーの選択でワークフローが大きく変わるため、メインで使うレンダラーを定義する。
- レンダラーをプロジェクトの途中で変更すると **作業の多くがやり直しになる** 可能性が非常に高い。
- プロジェクトのメインのレンダラーは決めておいた方がよい。
- 光の計算のため、レンダラーで単位設定が必要になるものもある。

# マテリアル
- 基本的にはレンダラー専用のマテリアルを使う
  - 最適化されているため余計な処理が行われず、レンダリングコスト軽減に繋がる
  - 正しい光のシミュレーション結果が得られる。
- 物理ベースマテリアルタイプの定義
  - タイプによってマテリアルの作り方などか異なってくるため
  - PBRのMetalness、Roughnessのタイプを決定。


## テクスチャ
- UDIM方式の決定
- OCIOを使用する際の命名規則
- ファイルフォーマット、ビット震度、可逆圧縮 / 非可逆圧縮

# トポロジ：
## 裏表
- ポリゴンには裏と表が存在する。
- 裏表が正しく定義出来ていないと、レンダリング、物理シミュレーションなどで意図せぬ結果になってしまう事がある。
  - レンダリング
    - 屈折率は「真空から物体に光が侵入したときの数値」。表裏が逆だと、屈折率が逆数になってしまう。
    - 裏面の計算を省略する事があるため、真っ黒や意図せぬ色で計算されるなど。
  - 衝突判定：裏面は衝突判定を省略しすり抜けてしまう事がある。
- 

### Tips:
- [ジオメトリの法線や厚みによる屈折の見え方の違い](https://yamagishi-2bit.blogspot.com/2021/04/3d-material.html)

## 厚み
- レンダリング用
  - 出来るだけ現実のものと同じにする
- クロスシミュレーション用
  - 現在のクロスシミュレーションは　**シミュレーション時に厚みを設定 するのが基本**　であるため、厚みはモデリングしない。逆に厚みを付けると正しくシミュレーション出来ない事が多い。

## 三角形ポリゴン、多角形ポリゴン
- 4角形ポリゴン以上の多角形ポリゴンの使用を極力避け、出来るだけ凹ポリゴンを作成しない。
- 必要のない分割は極力避ける。
- 現在のワークフローの場合、画面表示、画像出力共に殆どの場合、最終的には三角ポリゴンに変換されるのではないか？と思う

## サブディビジョン
- レンダラーで処理する結果とソフトウェアで処理する結果が異なる点に注意。最終出力のワークフローに注意。
- シェーダー（レンダリング時の計算）でサブディビジョンを行う際は、三角形ポリゴン、四角形ポリゴンで結果が異なるので注意が必要。
  - [YouTube : Subdivision Surfaces: Artifacts](https://www.youtube.com/watch?v=k_S1INdEmdI&list=PLYURcfRkTI5XxXw4NixOb4gG02iHFbJr4&index=2)
